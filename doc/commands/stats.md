# 統計・分析コマンド

リポジトリのステップ数やユーザーごとの貢献度などの統計・分析に関するコマンドです。

## git step

リポジトリ全体のステップ数とユーザーごとの貢献度を11の指標で集計します。追加比、削除比、更新比、コード割合など多角的な分析が可能です。

**使い方:**
```bash
git step                    # 全期間のステップ数を表示
git step -w 1               # 過去1週間
git step -m 1               # 過去1ヶ月
git step -y 1               # 過去1年
git step --since 2024-01-01 # 指定日以降
git step -s 2024-01-01      # 指定日以降（短縮形）
git step --include-initial  # 初回コミットを含める
git step -i                 # 初回コミットを含める（短縮形）
git step -h                 # ヘルプを表示
```

**動作:**
1. リポジトリ全体のステップ数（行数）とユーザーごとの貢献度を集計します。
2. デフォルトで初回コミットは除外されます（大量の行数が追加されることが多いため）。
3. コード割合が多い順に表示されます。
4. 各作成者の11の指標を表示します：
   - **追加**: 過去に追加した行数の累計
   - **削除**: 過去に削除した行数の累計
   - **更新**: 追加と削除の合計（変更に関わった総行数）
   - **現在**: 現在のコードベースに残っている行数（git blameベース）
   - **コミ**: コミット数
   - **平均**: 平均コミットサイズ（更新行数 / コミット数）
   - **追加比**: 全体の追加行数に占める割合
   - **削除比**: 全体の削除行数に占める割合
   - **更新比**: 全体の更新行数に占める割合
   - **コード割合**: 期間指定時は期間内のコード行数の合計に対する割合（合計100%）、期間指定なしは現在のリポジトリ総行数に占める割合（合計100%）
5. 現在のリポジトリ総行数も表示されます。
6. **結果は自動的にテキストファイル（`git_step_*.txt`）とCSVファイル（`git_step_*.csv`）に保存されます。**

**オプション:**
- `-w, --weeks <数>`: 過去N週間を集計
- `-m, --months <数>`: 過去Nヶ月を集計
- `-y, --years <数>`: 過去N年を集計
- `-s, --since <日時>`: 集計開始日時
- `-u, --until <日時>`: 集計終了日時
- `-i, --include-initial`: 初回コミットを含める（デフォルトは除外）
- `-h`: ヘルプを表示

**主な機能:**
- **11の包括的な指標**: 追加、削除、更新、現在、コミット数、平均コミットサイズ、追加比、削除比、更新比、コード割合を一度に確認できます。
- **CSV出力対応**: すべての指標を省略なしでCSV形式で出力するため、ExcelやGoogleスプレッドシートで分析できます。
- **貢献度の多角的な可視化**:
  - **追加比**、**削除比**、**更新比**で、チーム全体の作業量の中での相対的な貢献度が分かります。
  - **平均コミットサイズ**で、大きな変更を好むか小さく頻繁にコミットするかが分かります。
  - **コミット数**で、活動頻度が分かります。
  - **現在**と**コード割合**で、現在のコードベースへの実際の貢献度が分かります。
- **期間指定**: 特定の期間に限定した集計が可能です。期間指定時は、その期間内のコード行数を100%としてコード割合を計算します。
- **初回コミット除外**: デフォルトで初回コミットを除外することで、より実態に即した統計が得られます。

**注意事項:**
- バイナリファイルの行数は集計から除外されます。
- **現在**は`git blame`を使用して、現在のコードベースに実際に残っている各ユーザーの行数を正確に集計します。
- **コード割合**は、期間指定なしの場合は現在のリポジトリ総行数に対する各ユーザーの現在行数の割合、期間指定ありの場合は期間内のコード行数の合計に対する割合です（いずれも合計100%）。
- **追加比**、**削除比**、**更新比**は、それぞれ全体の追加行数・削除行数・更新行数に対する割合です。
- **平均コミットサイズ**が大きい場合、大規模な変更を一度にコミットする傾向があります。

リポジトリ全体の規模把握や、チームメンバーの貢献度を多角的に分析したい場合に便利です。
