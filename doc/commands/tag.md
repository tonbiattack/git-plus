# タグ操作コマンド

タグの作成、削除、チェックアウト、差分取得などのタグ管理に関するコマンドです。

## git reset-tag

指定したタグをローカルとリモートから削除し、最新コミットに再作成して再プッシュします。

```bash
git reset-tag v1.2.3
git reset-tag -h                 # ヘルプを表示
```

**動作:**
1. 指定したタグをローカルから削除します。
2. リモート（デフォルトでは `origin`）からも削除します。
3. 最新コミットに同名のタグを再作成します。
4. 新しいタグをリモートへプッシュし直します。

既存のタグが見つからない場合は警告が表示されますが、処理自体は継続します。再作成やプッシュに失敗した場合は終了コード 1 で停止するため、CI などでも利用できます。

## git tag-diff

2つのタグ間の差分を取得し、課題IDを抽出してファイルに出力します。リリースノート作成に便利です。

```bash
git tag-diff V4.2.00.00 V4.3.00.00
git tag-diff -h                    # ヘルプを表示
```

**動作:**
1. 2つのタグ間のコミット差分を取得します。
2. Mergeコミットは自動的に除外されます（`--no-merges`オプション使用）。
3. 出力形式は `- コミットメッセージ (作成者名, 日付)` です。
4. 出力ファイル名は自動的に `tag_diff_<旧タグ>_to_<新タグ>.txt` として生成されます。

指定したタグが存在しない場合や、タグ間に差分がない場合は適切なメッセージを表示します。

## git tag-checkout

最新のタグを取得してチェックアウトします。セマンティックバージョン順で並べられたタグから選択できます。

```bash
git tag-checkout                    # 最新10個のタグから選択
git tag-checkout -n 5               # 最新5個のタグから選択
git tag-checkout -y                 # 最新タグに自動チェックアウト
git tag-checkout --limit 20         # 最新20個のタグから選択
git tag-checkout -l                 # 最新タグを表示するのみ（--latest の短縮形）
git tag-checkout --latest           # 最新タグを表示するのみ
git tag-checkout -h                 # ヘルプを表示
```

**動作:**
1. セマンティックバージョン順（`--sort=-v:refname`）で最新のタグを取得します。
2. デフォルトで最新10個のタグを表示します（`-n` または `--limit` オプションで変更可能）。
3. 対話的にタグを選択してチェックアウトできます。
4. `-y` オプションを使用すると、確認なしで最新タグにチェックアウトします。
5. `--latest` オプションを使用すると、最新タグを表示するのみで終了します。

**オプション:**
- `-n, --limit <数>`: 表示するタグの数（デフォルト: 10）
- `-y, --yes`: 確認なしで最新タグにチェックアウト
- `-l, --latest`: 最新タグのみを表示して終了
- `-h`: ヘルプを表示

**主な機能:**
- **セマンティックバージョン順ソート**: `git tag --sort=-v:refname` を使用して、セマンティックバージョンに従って新しいもの → 古いものの順に並べます。
- **対話的な選択**: タグ一覧から番号を選択してチェックアウトできます。
- **高速チェックアウト**: `-y` オプションで最新タグに即座にチェックアウトできます。
- **最新タグの確認**: `--latest` オプションで最新タグを確認するのみの用途にも使えます。

引数は不要です。リリースタグやバージョンタグが多数存在する場合に、最新のタグに素早く切り替えたいときに便利です。

## git new-tag

セマンティックバージョニングに従って新しいタグを自動生成します。

```bash
git new-tag feature          # 機能追加（minor）
git new-tag bug              # バグ修正（patch）
git new-tag major            # 破壊的変更
git new-tag f -p             # 省略形 + プッシュ（-p は --push の短縮形）
git new-tag feature -p -r    # タグ作成、プッシュ、リリース作成（短縮形）
git new-tag feature --push --release              # タグ作成、プッシュ、リリース作成
git new-tag bug --push --release --release-draft  # ドラフトリリースとして作成
git new-tag bug -p -r -D     # ドラフトリリースとして作成（短縮形）
git new-tag -h               # ヘルプを表示
```

現在の最新タグから自動的に次のバージョンを計算します。`--release`フラグを使用すると、タグプッシュ後に自動的にGitHubリリースも作成できます。

**主な機能:**
- **自動バージョン計算**: 最新タグ（v1.2.3）から次のバージョンを自動計算
- **直感的なタイプ指定**: feature/bug で minor/patch を自動判定
- **省略形サポート**: f（feature）、b（bug）、m（major）など
- **確認プロンプト**: 誤ったタグ作成を防ぐ
- **自動プッシュ**: `--push` オプションでリモートへ自動プッシュ
- **自動リリース作成**: `--release` オプションでGitHubリリースも自動作成
- **対話的モード**: 引数なしで実行時に選択肢を表示

**バージョンタイプ:**

| タイプ | 説明 | 例 (v1.2.3 →) |
|-------|------|---------------|
| `major`, `m`, `breaking` | メジャーバージョンアップ | v2.0.0 |
| `minor`, `n`, `feature`, `f` | マイナーバージョンアップ | v1.3.0 |
| `patch`, `p`, `bug`, `b`, `fix` | パッチバージョンアップ | v1.2.4 |

**オプション:**
- `-m, --message <msg>`: タグメッセージを指定（アノテーテッドタグを作成）
- `-p, --push`: 作成後に自動的にリモートへプッシュ
- `-d, --dry-run`: 実際には作成せず、次のバージョンだけを表示
- `-r, --release`: プッシュ後に自動的にGitHubリリースを作成
- `-D, --release-draft`: リリースをドラフトとして作成
- `-P, --release-prerelease`: リリースをプレリリースとして作成

**使用例:**

```bash
# 機能追加のタグを作成
git new-tag feature
# 現在のタグ: v1.2.3
# 新しいタグ: v1.3.0 (MINOR)
# タグを作成しますか？ (y/N): y
# ✓ タグを作成しました: v1.3.0

# バグ修正のタグを作成してプッシュ
git new-tag bug --push
# ✓ タグを作成しました: v1.2.4
# ✓ リモートにプッシュしました: v1.2.4

# 省略形を使用
git new-tag f              # feature と同じ
git new-tag b              # bug と同じ

# メッセージ付きで作成
git new-tag feature -m "Add awesome feature"

# ドライラン（確認のみ）
git new-tag major --dry-run
# 現在のタグ: v1.2.3
# 次のバージョン: v2.0.0 (MAJOR)
# (--dry-run のため、タグは作成されません)

# 対話的モード
git new-tag
# 新しいタグのタイプを選択してください:
#   [1] major   - v2.0.0 (破壊的変更)
#   [2] minor   - v1.3.0 (機能追加)
#   [3] patch   - v1.2.4 (バグ修正)
# 選択 (1-3): 2

# タグ作成、プッシュ、リリース作成を一度に実行
git new-tag feature --push --release
# ✓ タグを作成しました: v1.3.0
# ✓ リモートにプッシュしました: v1.3.0
#
# GitHubリリースを作成中...
# ✓ GitHubリリースを作成しました
# 詳細を確認するには: gh release view v1.3.0 --web

# ドラフトリリースとして作成
git new-tag bug --push --release --release-draft

# プレリリースとして作成
git new-tag minor --push --release --release-prerelease
```

**動作:**
1. 最新のタグを取得（`git describe --tags --abbrev=0`）
2. バージョン番号を解析（v1.2.3 → MAJOR=1, MINOR=2, PATCH=3）
3. 指定されたタイプに応じて新しいバージョンを計算
4. 確認プロンプトを表示
5. タグを作成（メッセージありの場合はアノテーテッドタグ）
6. `--push` オプションがある場合はリモートへプッシュ
7. `--release` オプションがある場合はGitHubリリースを作成（`gh release create --generate-notes`）

**注意事項:**
- タグが存在しない場合はエラーになります。最初のタグは手動で作成してください（例: `git tag v0.1.0`）
- セマンティックバージョニング（v1.2.3形式）に従ったタグが必要です
- リモートへのプッシュは `--push` オプションを指定した場合のみ実行されます
- リリース作成には `--push` オプションが必要です（タグがリモートにプッシュされている必要があるため）
- リリース作成には GitHub CLI (gh) がインストールされ、ログイン済みである必要があります
- 対話モードでは、タグをプッシュした後に「GitHubリリースを作成しますか？」という確認プロンプトが表示されます
