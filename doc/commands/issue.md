# Issue管理コマンド

GitHubのIssueの作成、編集、閲覧などのIssue管理に関するコマンドです。

## git issue-create

エディタで題名と本文を入力し、GitHubに新しいissueを作成します。ユーザーが設定しているエディタで編集できます。

**使い方:**
```bash
git issue-create
git issue-create -h              # ヘルプを表示
```

**処理フロー:**
1. ユーザーが設定しているエディタで題名と本文を入力
2. 入力内容でGitHubに新しいissueを作成
3. 作成したissueのURLを表示

**使用例:**
```bash
git issue-create
```

**実行の流れ:**
```
エディタで新しいissueを作成中... (code --wait)

# エディタで以下のような内容を入力:
# Title: 新機能の提案
# ---
#
# ダークモード機能を追加してほしいです。
# 詳細は以下の通りです...

✓ issueを作成しました
URL: https://github.com/username/repo/issues/45
```

**エディタの設定:**

エディタは以下の優先順位で自動検出されます：
1. `git config core.editor` の設定
2. 環境変数 `VISUAL`
3. 環境変数 `EDITOR`
4. デフォルト（vi）

VSCodeを使用する場合は、以下のように設定します：
```bash
git config --global core.editor "code --wait"
```

**一時ファイルの形式:**

エディタで開かれるファイルは以下のような形式です：
```markdown
# 新しいIssueを作成
#
# 以下のissueの題名と本文を入力してください。
# '#' で始まる行はコメントとして無視されます。
# 'Title:' の後に題名を記載し、'---' の区切り線の後に本文を記載してください。
# ファイルを保存して閉じると、issueが作成されます。
# ========================================

Title:

---

```

**主な機能:**
- **エディタで編集**: ユーザーが設定しているエディタで題名と本文を入力可能
- **コメント行除外**: `#` で始まる行はコメントとして無視
- **URL表示**: 作成後にissueのURLを表示
- **空チェック**: 題名が空の場合はissue作成をキャンセル

**注意事項:**
- GitHub CLI (`gh`) がインストールされている必要があります
- `gh auth login` でログイン済みである必要があります
- 題名は必須です。題名が空の場合はissue作成をキャンセルします
- 本文は空でも作成可能です
- タイトルは `Title:` の後に、本文は `---` の区切り線の後に記載します

## git issue-edit

GitHubのopenしているissueの一覧を表示し、選択したissueをエディタで編集します。題名（title）と本文（body）の両方を編集できます。-v/--viewオプションで閲覧のみ、-m/--commentオプションでコメント追加（クローズしない）、-c/--closeオプションでコメント入力後にクローズが可能です。

**使い方:**
```bash
git issue-edit              # 編集モード
git issue-edit -v           # 閲覧モード
git issue-edit --view       # 閲覧モード（ロングオプション）
git issue-edit -m           # コメント追加モード（クローズしない）
git issue-edit -c           # コメント入力後にクローズ
git issue-edit -h           # ヘルプを表示
```

**処理フロー（編集モード）:**
1. GitHubのopenしているissueを一覧表示
2. 番号を入力してissueを選択
3. 選択したissueの題名と本文を一時ファイルに書き出し
4. ユーザーが設定しているエディタで編集
5. 編集内容でissueを更新

**処理フロー（閲覧モード -v/--view）:**
1. GitHubのopenしているissueを一覧表示
2. 番号を入力してissueを選択
3. 選択したissueの題名と本文を表示
4. 編集は行わずに終了

**処理フロー（コメント追加モード -m/--comment）:**
1. GitHubのopenしているissueを一覧表示
2. 番号を入力してissueを選択
3. エディタでコメントを入力
4. コメントをissueに投稿（クローズしない）

**処理フロー（クローズモード -c/--close）:**
1. GitHubのopenしているissueを一覧表示
2. 番号を入力してissueを選択
3. エディタでコメントを入力（任意）
4. コメントが入力された場合は投稿
5. issueをクローズ

**使用例（編集モード）:**
```bash
git issue-edit
```

**実行の流れ（編集モード）:**
```
Open Issue一覧 (3 個):

1. #42: ログイン機能の不具合
   ログインボタンを押しても反応がない...

2. #43: ダークモード対応
   ダークモードのデザインを実装してほしい...

3. #44: パフォーマンス改善
   初回読み込みが遅いため改善が必要...

編集するissueを選択してください (番号を入力、Enterでキャンセル): 2

選択されたissue: #43
タイトル: ダークモード対応
URL: https://github.com/username/repo/issues/43

エディタで編集中... (code --wait)
✓ issueを更新しました
```

**使用例（閲覧モード）:**
```bash
git issue-edit -v
```

**使用例（コメント追加モード）:**
```bash
git issue-edit -m
```

**使用例（クローズモード）:**
```bash
git issue-edit -c
```

**エディタの設定:**

エディタは以下の優先順位で自動検出されます：
1. `git config core.editor` の設定
2. 環境変数 `VISUAL`
3. 環境変数 `EDITOR`
4. デフォルト（vi）

VSCodeを使用する場合は、以下のように設定します：
```bash
git config --global core.editor "code --wait"
```

**一時ファイルの形式（編集モード）:**

エディタで開かれるファイルは以下のような形式です：
```markdown
# Issue #43
# URL: https://github.com/username/repo/issues/43
#
# 以下のissueの題名と本文を編集してください。
# '#' で始まる行はコメントとして無視されます。
# 'Title:' の後に題名を記載し、'---' の区切り線の後に本文を記載してください。
# ファイルを保存して閉じると、issueが更新されます。
# ========================================

Title: ダークモード対応

---

現在の本文がここに表示されます。
この部分を編集して保存すると、issueが更新されます。
```

**一時ファイルの形式（コメント追加モード）:**

エディタで開かれるファイルは以下のような形式です：
```markdown
# Issue #43 へのコメント
# URL: https://github.com/username/repo/issues/43
#
# このissueに追加するコメントを記載してください。
# '#' で始まる行はコメントとして無視されます。
# ファイルを保存して閉じると、コメントが投稿されます。
# ========================================

```

**主な機能:**
- **一覧表示**: openしているissueを番号付きで表示
- **プレビュー**: 各issueの本文の最初の50文字をプレビュー表示
- **タイトル編集**: issueのタイトルも編集可能
- **本文編集**: issueの本文も編集可能
- **エディタ編集**: ユーザーが設定しているエディタで編集可能
- **コメント行除外**: `#` で始まる行はコメントとして無視
- **変更検出**: タイトルと本文の両方で変更を検出し、変更がない場合は更新をスキップ
- **閲覧モード**: -v/--viewオプションで編集せずに閲覧のみ可能
- **コメント追加**: -m/--commentオプションでエディタからコメントを追加可能（クローズしない）
- **issueクローズ**: -c/--closeオプションでコメント入力後にissueをクローズ可能
- **柔軟な運用**: コメントは任意で、空の場合はコメントなしでクローズ

**注意事項:**
- GitHub CLI (`gh`) がインストールされている必要があります
- `gh auth login` でログイン済みである必要があります
- タイトルと本文の両方を編集できます
- タイトルは `Title:` の後に、本文は `---` の区切り線の後に記載します

## git issue-list

GitHubのopenしているissue一覧を取得し、番号で選択して編集・コメント追加・クローズ・新規作成・一括クローズを実行できる統合ビューアです。日常的なIssue対応をこの画面だけで完結できます。

**使い方:**
```bash
git issue-list
git issue-list -h              # ヘルプを表示
```

**処理フロー:**
1. `gh issue list` でopenしているIssueを取得し、番号付きで一覧表示（タイトルと本文の冒頭をプレビュー）。
2. 入力待ちのプロンプトで番号またはショートカットを受付。
3. 番号を入力すると詳細ビューとアクションメニューを表示。
4. 選択したアクションを実行後は再び一覧に戻り、必要な回数だけ繰り返し操作できます。

**一覧画面で使える入力:**

- `1`〜`n`: 指定したIssueの詳細を表示しアクションメニューへ。
- `n`: 新しいIssueを作成（`git issue-create` と同じエディタフロー）。
- `bc`: 表示中のIssueの中から複数件を選択して一括クローズ。
- `q`: 即終了。
- Enterのみ: 不正入力扱いで再度入力待ちになります。

**アクションメニュー（番号入力後）:**

- `e`: 選択したIssueをエディタで編集。
- `m`: コメントを追加（本文だけ編集）。
- `c`: コメント入力→Issueクローズ。コメントを空にするとコメント無しでクローズ。
- `n`: 別の新規Issueを作成。
- `b`: 一覧に戻る。
- `q`: issue-list全体を終了。

**主な機能:**
- Issue一覧と本文プレビューの同時表示。
- 詳細画面からそのまま編集/コメント/クローズを実行。
- 一括クローズ操作（`bc`）を内蔵し、複数番号をまとめて処理可能。
- 空のIssue一覧でも新規作成に誘導。
- `git config core.editor` / `VISUAL` / `EDITOR` で設定されたエディタを自動利用。

**注意事項:**
- GitHub CLI (`gh`) が必要です。`gh auth login` 済みであることを確認してください。
- 一括クローズ後は一覧が再取得され、直前の選択状態はリセットされます。
- コメントやクローズ処理はIssueごとに逐次実行されるため、途中で失敗した場合も結果サマリーに成功/失敗件数が表示されます。

## git issue-bulk-close

複数のIssue番号を指定し、同じコメントを投稿してからまとめてクローズします。issue-listの `bc` からも内部的に呼び出されるほか、単独コマンドとしても利用できます。

**使い方:**
```bash
git issue-bulk-close 12 15 18             # Issue 12,15,18 を一括クローズ（コメントはエディタ入力）
git issue-bulk-close 42 43 -m "対応完了"   # 42と43を同じコメントでクローズ
git issue-bulk-close １ ２ ３             # 全角数字も入力可
git issue-bulk-close -h                   # ヘルプを表示
```

**オプション:**

- `-m, --message <text>`: コメントを直接指定。省略すると一時ファイルをエディタで開いて入力。

**処理フロー:**
1. 引数のIssue番号を正規化（全角→半角、重複排除）し、openかどうかチェック。
2. 対象Issueのタイトル一覧を表示して最終確認。
3. コメントを取得（`-m` 指定時はそのまま使用、未指定時はエディタで入力）。空でも可。
4. 各Issueに対してコメント投稿（任意）→`gh issue close` でクローズを順に実行。
5. 成功/失敗件数をサマリー表示。

**コメント入力テンプレート（エディタ起動時）:**
```markdown
# 一括クローズ用コメント
#
# 以下のissueに同じコメントを投稿してクローズします:
# - Issue #12
# - Issue #15
# - Issue #18
# ...
# コメントを空にするとコメントなしでクローズされます。
```

**使用例:**
```bash
# バグ修正が完了したIssueをまとめて閉じる
git issue-bulk-close 101 104 105 -m "Fix deployed to production"

# コメントを書きながら確認したい場合
git issue-bulk-close 21 22 23
```

**注意事項:**
- GitHub CLI (`gh`) が必要です。`gh auth login` 済みであることを確認してください。
- 既にクローズ済みのIssueは警告を出してスキップします。
- コメントを空にするとコメント追加をスキップした状態でクローズのみ実行します。
- 大量のIssueを指定した場合は順次処理されるため、途中で失敗した番号があっても残りは続行します。
